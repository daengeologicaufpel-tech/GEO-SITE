<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publicações - DAFPO</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        /* CSS GERAL (sem alterações) */
        :root {
            --color-primary-green: #67651c;
            --color-heading-maroon: #702727;
            --color-background: #f4f4f4;
            --color-surface: #ffffff;
            --color-text-primary: #2d2d2d;
            --color-text-secondary: #5f5f5f;
            --color-text-light: #fdfdfc;
            --font-body: 'Poppins', sans-serif;
            --font-heading: 'Lora', serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-body); background-color: var(--color-background); color: var(--color-text-primary); }
        .site-header { position: sticky; top: 0; width: 100%; z-index: 1000; background-color: var(--color-primary-green); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; padding: 10px 30px; height: 70px; }
        .logo { height: 50px; width: auto; }
        .main-nav ul { display: flex; list-style: none; }
        .main-nav ul li { position: relative; }
        .main-nav ul li a { color: var(--color-text-light); text-decoration: none; padding: 10px 15px; font-weight: 500; display: flex; align-items: center; gap: 4px; }
        .dropdown-menu { list-style: none; position: absolute; top: 100%; left: 0; background-color: var(--color-primary-green); min-width: 180px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border-radius: 0 0 4px 4px; opacity: 0; visibility: hidden; transform: translateY(10px); transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s 0.3s; z-index: 1001;}
        .main-nav ul li:hover > .dropdown-menu { opacity: 1; visibility: visible; transform: translateY(0); transition-delay: 0s; }
        .dropdown-menu li a { padding: 12px 20px; white-space: nowrap; transition: background-color 0.3s ease; }
        .dropdown-menu li a:hover { background-color: rgba(255, 255, 255, 0.1); }
        .dropdown-menu--wide { display: grid; grid-template-columns: repeat(2, 1fr); min-width: 450px; gap: 0 10px; }
        .dropdown-menu--wide li a { white-space: normal; text-align: left; }
        .dropdown-arrow { display: none; width: 18px; height: 18px; fill: currentColor; }
        .login-button { background-color: var(--color-surface); color: var(--color-primary-green); border: 1px solid transparent; padding: 8px 20px; border-radius: 20px; text-decoration: none; transition: all 0.3s ease; cursor: pointer; }
        .login-button:hover { background-color: rgba(255,255,255,0.8); }
        .menu-toggle { display: none; background: none; border: none; cursor: pointer; z-index: 1002; }
        .menu-toggle svg path { stroke: var(--color-text-light); }
        .site-footer { background-color: var(--color-text-primary); color: var(--color-text-light); padding: 50px 40px; margin-top: 40px; }
        .footer-container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; }
        .footer-column h3 { font-family: var(--font-heading); color: var(--color-surface); margin-bottom: 15px; font-size: 1.3rem; }
        .footer-column p, .footer-column a { color: rgba(255, 255, 255, 0.8); text-decoration: none; line-height: 1.7; }
        .footer-column a:hover { color: white; text-decoration: underline; }
        .social-links { display: flex; gap: 15px; margin-top: 15px; }
        .social-links a { display: inline-block; transition: transform 0.3s ease; }
        .social-links a:hover { transform: scale(1.1); }
        .social-links svg { width: 24px; height: 24px; fill: var(--color-text-light); }
        .footer-bottom { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); }

        /* CSS DA PÁGINA DE POSTS (com adições) */
        .page-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; min-height: 60vh; }
        .page-header { text-align: center; margin-bottom: 40px; }
        .page-header h1 { font-family: var(--font-heading); font-size: 2.8rem; color: var(--color-heading-maroon); }
        .search-bar { margin-bottom: 40px; text-align: center; }
        #search-input { width: 100%; max-width: 500px; padding: 12px 20px; font-size: 1rem; border: 2px solid #ddd; border-radius: 25px; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        #search-input:focus { outline: none; border-color: var(--color-primary-green); box-shadow: 0 0 8px rgba(103, 101, 28, 0.2); }
        .posts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; }
        .post-card { background-color: var(--color-surface); border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; }
        .post-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.12); }
        .post-card a { text-decoration: none; color: inherit; display: flex; flex-direction: column; flex-grow: 1; }
        .post-card-image img { width: 100%; height: 200px; object-fit: cover; }
        .post-card-content { padding: 20px; display: flex; flex-direction: column; flex-grow: 1; }
        .post-date { font-size: 0.8rem; color: var(--color-text-secondary); margin-bottom: 8px; display: block; }
        .post-title { font-family: var(--font-heading); font-size: 1.4rem; margin-bottom: 10px; }
        .post-excerpt { font-size: 0.95rem; line-height: 1.6; color: var(--color-text-secondary); flex-grow: 1; }
        #loading-indicator { text-align: center; font-size: 1.2rem; color: var(--color-text-secondary); padding: 40px; }
        .hidden { display: none; } /* Classe utilitária para esconder elementos */

        /* --- NOVOS ESTILOS PARA O POST INDIVIDUAL --- */
        .single-post-container { max-width: 800px; margin: 20px auto; background-color: var(--color-surface); padding: 30px 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .post-header-image { width: 100%; height: auto; max-height: 400px; object-fit: cover; border-radius: 8px; margin-bottom: 25px; }
        .single-post-title { font-family: var(--font-heading); font-size: 2.5rem; color: var(--color-heading-maroon); margin-bottom: 10px; line-height: 1.2; }
        .post-meta { color: var(--color-text-secondary); margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .post-content { font-size: 1.1rem; line-height: 1.8; color: var(--color-text-primary); }
        .post-content h2 { font-family: var(--font-heading); font-size: 1.8rem; margin-top: 30px; margin-bottom: 15px; color: var(--color-text-primary); }
        .post-content p { margin-bottom: 1.2em; }
        .post-content a { color: var(--color-primary-green); text-decoration: none; font-weight: 600; }
        .post-content a:hover { text-decoration: underline; }
        .post-content img { max-width: 100%; height: auto; border-radius: 8px; margin: 20px 0; }
        .back-to-posts { display: inline-block; margin-top: 40px; font-weight: 600; color: var(--color-primary-green); text-decoration: none; }
        .back-to-posts:hover { text-decoration: underline; }

        /* Media Queries */
        @media (max-width: 992px) {
            .main-nav ul { display: none; flex-direction: column; position: absolute; top: 70px; left: 0; width: 100%; background-color: var(--color-primary-green); box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
            .main-nav ul.nav-active { display: flex; }
            .main-nav ul li a { color: var(--color-text-light); border-bottom: 1px solid rgba(255,255,255,0.1); }
            .main-nav ul li.dropdown-active > .dropdown-menu { display: block; }
            .main-nav ul li:hover > .dropdown-menu { display: none; }
            .main-nav ul li.dropdown-active:hover > .dropdown-menu { display: block; }
            .dropdown-menu { position: static; box-shadow: none; border-radius: 0; background-color: rgba(0,0,0,0.2); opacity: 1; visibility: visible; transform: none; transition: none; display: none; }
            .dropdown-menu--wide { display: none; min-width: auto; gap: 0; grid-template-columns: 1fr; }
            .dropdown-arrow { display: inline-block; }
            .menu-toggle { display: block; z-index: 10; }
        }
        @media (max-width: 768px) { 
            .nav-container { padding: 10px 20px; } 
            .page-container { padding: 0 15px; margin: 20px auto; }
            .page-header h1 { font-size: 2.2rem; }
            .posts-grid { grid-template-columns: 1fr; }
            .single-post-container { padding: 20px; }
            .single-post-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <header class="site-header">
        <div class="nav-container">
            <a href="index.html"><img src="img/logo-dafpo.png" alt="Logo do DAFPO" class="logo"></a>
            <nav class="main-nav">
                <ul id="nav-list">
                    <li><a href="index.html">Início</a></li>
                    <li><a href="post.html">Posts</a></li>
                    <li class="has-dropdown">
                        <a href="origem.html">Quem somos 
                            <svg class="dropdown-arrow" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"></path></svg>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="origem.html">Origem</a></li>
                            <li><a href="diretorias.html">Diretorias</a></li>
                            <li><a href="estatuto.html">Estatuto</a></li>
                        </ul>
                    </li>
                    <li class="has-dropdown">
                        <a href="curso.html">O Curso
                            <svg class="dropdown-arrow" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"></path></svg>
                        </a>
                        <ul class="dropdown-menu dropdown-menu--wide">
                            <li><a href="curso.html">O curso de Engenharia Geológica</a></li>
                            <li><a href="projeto-pedagogico.html">Projeto pedagógico do curso</a></li>
                            <li><a href="egressos.html">Egressos</a></li>
                            <li><a href="professores.html">Professores</a></li>
                            <li><a href="laboratorios.html">Laboratórios</a></li>
                            <li><a href="projetos.html">Projetos de Pesquisa, Ensino e Extensão</a></li>
                        </ul>
                    </li>
                    <li><a href="https://geolojapay.netlify.app/" target="_blank" rel="noopener noreferrer">GeoLoja</a></li>
                    <li><a href="contato.html">Fale Conosco</a></li>
                    <li><a href="eventos.html">Eventos</a></li>
                    <li><a href="galeria.html">Galeria</a></li>
                </ul>
            </nav>
            <a class="login-button" id="login-button">Fazer login</a>
            <button class="menu-toggle" id="menu-toggle" aria-label="Abrir menu">
                <svg width="24" height="24" viewBox="0 0 24 24"><path d="M3 12H21" stroke="currentColor" stroke-width="2"/><path d="M3 6H21" stroke="currentColor" stroke-width="2"/><path d="M3 18H21" stroke="currentColor" stroke-width="2"/></svg>
            </button>
        </div>
    </header>

    <main class="page-container">
        <div id="list-view">
            <header class="page-header">
                <h1>Todas as Publicações</h1>
            </header>
            <div class="search-bar">
                <input type="search" id="search-input" placeholder="Pesquisar por título ou resumo...">
            </div>
            <div class="posts-grid" id="all-posts-grid">
                <p id="loading-indicator">Carregando publicações...</p>
            </div>
        </div>

        <div id="single-post-view" class="single-post-container hidden">
            </div>
    </main>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h3>Quem Somos</h3>
                <p>O Diretório Acadêmico Francisco de Paula Oliveira (DAFPO) é a entidade que representa os estudantes do curso de Engenharia Geológica da UFPel.</p>
            </div>
            <div class="footer-column">
                <h3>Contato</h3>
                <p>Email: <a href="mailto:diretorioengeologica@gmail.com">diretorioengeologica@gmail.com</a></p>
                <div class="social-links">
                    <a href="https://www.instagram.com/engeo.ufpel" target="_blank" aria-label="Instagram"><svg viewBox="0 0 24 24"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path></svg></a>
                    <a href="https://www.facebook.com/dafpo.ufpel" target="_blank" aria-label="Facebook"><svg viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3l-.5 3h-2.5v6.8c4.56-.93 8-4.96 8-9.8z"></path></svg></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 por DAFPO - Engenharia Geológica UFPel. Todos os direitos reservados.</p>
        </div>
    </footer>
    
    <script>
        // Scripts do menu e login (sem alterações)
        const menuToggle = document.getElementById('menu-toggle');
        const navList = document.getElementById('nav-list');
        if (menuToggle) {
            menuToggle.addEventListener('click', () => navList.classList.toggle('nav-active'));
        }
        document.querySelectorAll('.has-dropdown > a').forEach(menuLink => {
            menuLink.addEventListener('click', function(event) {
                if (window.innerWidth <= 992) {
                    event.preventDefault();
                    this.parentElement.classList.toggle('dropdown-active');
                }
            });
        });
        const loginButton = document.getElementById('login-button');
        if (loginButton) {
            loginButton.addEventListener('click', () => {
                if (window.netlifyIdentity) netlifyIdentity.open();
            });
        }

        // --- SCRIPT PRINCIPAL TOTALMENTE REFEITO ---
        document.addEventListener('DOMContentLoaded', () => {
            const GITHUB_USER = "daengeologicaufpel-tech";
            const GITHUB_REPO = "GEO-SITE";
            
            // Elementos da Visão de Lista
            const listView = document.getElementById('list-view');
            const postsGrid = document.getElementById('all-posts-grid');
            const searchInput = document.getElementById('search-input');
            const loadingIndicator = document.getElementById('loading-indicator');

            // Elementos da Visão de Post Individual
            const singlePostView = document.getElementById('single-post-view');
            
            // Lógica para decidir se mostra a lista ou um post individual
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');

            if (slug) {
                // Se tem slug na URL, mostra o post individual
                displaySinglePost(slug);
            } else {
                // Se não tem slug, mostra a lista de posts
                displayPostList();
            }

            // ==========================================================
            // FUNÇÕES PARA A VISÃO DE POST INDIVIDUAL
            // ==========================================================
            async function displaySinglePost(slug) {
                listView.classList.add('hidden');
                singlePostView.classList.remove('hidden');
                singlePostView.innerHTML = `<p>Carregando post...</p>`;

                try {
                    const postUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/_posts/${slug}.md`;
                    const response = await fetch(postUrl, { headers: { 'Accept': 'application/vnd.github.v3.raw' } });
                    
                    if (!response.ok) throw new Error('Post não encontrado.');

                    const markdownContent = await response.text();
                    
                    const postData = parseFullMarkdown(markdownContent);
                    document.title = `${postData.frontmatter.title} - DAFPO`; // Atualiza o título da página

                    const postHtml = `
                        <img src="${postData.frontmatter.thumbnail}" alt="${postData.frontmatter.title}" class="post-header-image">
                        <h1 class="single-post-title">${postData.frontmatter.title}</h1>
                        <p class="post-meta">Publicado em ${new Date(postData.frontmatter.date).toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                        <div class="post-content">
                            ${convertMarkdownToHtml(postData.body)}
                        </div>
                        <a href="post.html" class="back-to-posts">← Voltar para todas as publicações</a>
                    `;
                    singlePostView.innerHTML = postHtml;

                } catch (error) {
                    console.error("Erro ao carregar o post:", error);
                    singlePostView.innerHTML = `<p>Erro ao carregar a publicação. Verifique o link ou tente novamente.</p> <a href="post.html" class="back-to-posts">← Voltar</a>`;
                }
            }
            
            function parseFullMarkdown(markdown) {
                const frontmatterMatch = markdown.match(/---([\s\S]*?)---/);
                const frontmatter = {};
                if (frontmatterMatch) {
                    frontmatterMatch[1].trim().split('\n').forEach(line => {
                        const [key, ...valueParts] = line.split(':');
                        if (key) frontmatter[key.trim()] = valueParts.join(':').trim().replace(/['"]/g, '');
                    });
                }
                const body = markdown.replace(/---[\s\S]*?---/, '').trim();
                return { frontmatter, body };
            }

            function convertMarkdownToHtml(md) {
                let html = md
                    // Títulos (h2, h3)
                    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                    // Imagens: ![alt](src)
                    .replace(/!\[(.*?)\]\((.*?)\)/gim, '<img src="$2" alt="$1">')
                    // Links: [text](href)
                    .replace(/\[(.*?)\]\((.*?)\)/gim, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
                    // Negrito: **text** ou __text__
                    .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                    .replace(/__(.*?)__/gim, '<strong>$1</strong>')
                    // Itálico: *text* ou _text_
                    .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                    .replace(/_(.*?)_/gim, '<em>$1</em>')
                    // Parágrafos (adiciona tags <p> em linhas que não são tags HTML)
                    .split('\n').map(line => line.trim() === '' ? '' : `<p>${line}</p>`).join('')
                    // Limpa parágrafos vazios ou em volta de outras tags
                    .replace(/<p><(h[2-3]|img|strong|em)(.*?)<\/\1><\/p>/gim, '<$1$2</$1>')
                    .replace(/<p>\s*<\/p>/g, '');

                return html;
            }


            // ==========================================================
            // FUNÇÕES PARA A VISÃO DE LISTA DE POSTS
            // ==========================================================
            async function displayPostList() {
                let allPostsData = [];
                const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/_posts`;
                
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`Erro de rede: ${response.statusText}`);
                    
                    const files = await response.json();
                    if (!Array.isArray(files) || files.message) throw new Error("A pasta _posts não foi encontrada.");

                    const fetchPromises = files.map(file => 
                        fetch(file.download_url).then(res => res.text()).then(content => {
                            const post = parseFrontmatter(content);
                            if (post) {
                                post.slug = file.name.replace(/\.md$/, '');
                                return post;
                            }
                            return null;
                        })
                    );
                    
                    allPostsData = (await Promise.all(fetchPromises)).filter(p => p !== null);
                    allPostsData.sort((a, b) => new Date(b.date) - new Date(a.date));

                    renderPosts(allPostsData);

                    searchInput.addEventListener('input', (e) => {
                        const searchTerm = e.target.value.toLowerCase();
                        const filteredPosts = allPostsData.filter(post => 
                            post.title.toLowerCase().includes(searchTerm) || 
                            post.excerpt.toLowerCase().includes(searchTerm)
                        );
                        renderPosts(filteredPosts);
                    });

                } catch (error) {
                    console.error('Erro ao carregar posts:', error);
                    postsGrid.innerHTML = '<p>Não foi possível carregar as publicações.</p>';
                } finally {
                    if(loadingIndicator) loadingIndicator.classList.add('hidden');
                }
            }

            function parseFrontmatter(text) {
                const match = text.match(/---([\s\S]*?)---/);
                if (!match) return null;
                const data = {};
                match[1].trim().split('\n').forEach(line => {
                    const [key, ...valueParts] = line.split(':');
                    if (key) data[key.trim()] = valueParts.join(':').trim().replace(/['"]/g, '');
                });
                return data;
            }

            function renderPosts(posts) {
                postsGrid.innerHTML = '';
                if (posts.length === 0) {
                    postsGrid.innerHTML = '<p>Nenhuma publicação encontrada com o termo pesquisado.</p>';
                    return;
                }
                posts.forEach(post => {
                    const postCard = document.createElement('article');
                    postCard.className = 'post-card';
                    const postDate = new Date(post.date);
                    const formattedDate = postDate.toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });
                    postCard.innerHTML = `
                        <a href="post.html?slug=${post.slug}">
                            <div class="post-card-image">
                                <img src="${post.thumbnail}" alt="Imagem para ${post.title}">
                            </div>
                            <div class="post-card-content">
                                <span class="post-date">${formattedDate}</span>
                                <h3 class="post-title">${post.title}</h3>
                                <p class="post-excerpt">${post.excerpt}</p>
                            </div>
                        </a>
                    `;
                    postsGrid.appendChild(postCard);
                });
            }
        });
    </script>
</body>
</html>
